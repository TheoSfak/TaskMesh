<div x-data="settingsPage()" x-init="init()" class="space-y-6">
    
    <!-- Role-Based Settings Access -->
    
    <!-- MEMBER Settings -->
    <div x-show="userRole === 'MEMBER'" class="space-y-6">
        <div class="glass rounded-3xl p-8">
            <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-6">
                <i class="fas fa-user-cog mr-3"></i>Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ­Ï‚ Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚
            </h1>
            
            <!-- Member Tabs -->
            <div class="flex gap-2 mb-6 border-b border-gray-200 dark:border-gray-700">
                <button @click="activeTab = 'profile'" 
                        :class="activeTab === 'profile' ? 'border-b-2 border-purple-600 text-purple-600' : 'text-gray-600'"
                        class="px-4 py-3 font-semibold transition">
                    <i class="fas fa-user mr-2"></i>Î ÏÎ¿Ï†Î¯Î»
                </button>
                <button @click="activeTab = 'preferences'" 
                        :class="activeTab === 'preferences' ? 'border-b-2 border-purple-600 text-purple-600' : 'text-gray-600'"
                        class="px-4 py-3 font-semibold transition">
                    <i class="fas fa-sliders-h mr-2"></i>Î ÏÎ¿Ï„Î¹Î¼Î®ÏƒÎµÎ¹Ï‚
                </button>
                <button @click="activeTab = 'notifications'" 
                        :class="activeTab === 'notifications' ? 'border-b-2 border-purple-600 text-purple-600' : 'text-gray-600'"
                        class="px-4 py-3 font-semibold transition">
                    <i class="fas fa-bell mr-2"></i>Î•Î¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚
                </button>
            </div>
            
            <p class="text-gray-600 dark:text-gray-400 mb-4">
                Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ­Ï‚ ÏƒÎ±Ï‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ ÎºÎ±Î¹ Ï€ÏÎ¿Ï„Î¹Î¼Î®ÏƒÎµÎ¹Ï‚.
            </p>
            
            <!-- Member Settings Content -->
            <div x-show="activeTab === 'profile'" class="space-y-4">
                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4">
                    <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                    Î‘Î»Î»Î±Î³Î® Ï€ÏÎ¿Ï†Î¯Î» ÎºÎ±Î¹ ÎºÏ‰Î´Î¹ÎºÎ¿Ï Î³Î¯Î½ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î· ÏƒÎµÎ»Î¯Î´Î± Profile.
                </div>
            </div>
            
            <div x-show="activeTab === 'preferences'" class="space-y-4">
                <p class="text-sm text-gray-500">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„Î¹Ï‚ Ï€ÏÎ¿Ï„Î¹Î¼Î®ÏƒÎµÎ¹Ï‚ ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î³Î»ÏÏƒÏƒÎ±Ï‚.</p>
                <!-- Add preference settings here -->
            </div>
            
            <div x-show="activeTab === 'notifications'" class="space-y-4">
                <p class="text-sm text-gray-500">Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ ÏƒÎ±Ï‚.</p>
                <!-- Add notification settings here -->
            </div>
        </div>
    </div>
    
    <!-- MANAGER Settings -->
    <div x-show="userRole === 'MANAGER'" class="space-y-6">
        <div class="glass rounded-3xl p-8">
            <h1 class="text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-6">
                <i class="fas fa-users-cog mr-3"></i>Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Manager
            </h1>
            
            <!-- Manager Tabs -->
            <div class="flex gap-2 mb-6 flex-wrap border-b border-gray-200 dark:border-gray-700">
                <button @click="activeTab = 'profile'" 
                        :class="activeTab === 'profile' ? 'border-b-2 border-indigo-600 text-indigo-600' : 'text-gray-600'"
                        class="px-4 py-3 font-semibold transition">
                    <i class="fas fa-user mr-2"></i>Î ÏÎ¿Ï†Î¯Î»
                </button>
                <button @click="activeTab = 'teams'" 
                        :class="activeTab === 'teams' ? 'border-b-2 border-indigo-600 text-indigo-600' : 'text-gray-600'"
                        class="px-4 py-3 font-semibold transition">
                    <i class="fas fa-users mr-2"></i>ÎŸÎ¼Î¬Î´ÎµÏ‚
                </button>
                <button @click="activeTab = 'preferences'" 
                        :class="activeTab === 'preferences' ? 'border-b-2 border-indigo-600 text-indigo-600' : 'text-gray-600'"
                        class="px-4 py-3 font-semibold transition">
                    <i class="fas fa-sliders-h mr-2"></i>Î ÏÎ¿Ï„Î¹Î¼Î®ÏƒÎµÎ¹Ï‚
                </button>
                <button @click="activeTab = 'notifications'" 
                        :class="activeTab === 'notifications' ? 'border-b-2 border-indigo-600 text-indigo-600' : 'text-gray-600'"
                        class="px-4 py-3 font-semibold transition">
                    <i class="fas fa-bell mr-2"></i>Î•Î¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚
                </button>
            </div>
            
            <p class="text-gray-600 dark:text-gray-400 mb-4">
                Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ Î¿Î¼Î¬Î´ÎµÏ‚ ÏƒÎ±Ï‚ ÎºÎ±Î¹ Ï„Î¹Ï‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Ï‰Ï‚ Manager.
            </p>
            
            <!-- Manager Settings Content -->
            <div x-show="activeTab === 'profile'" class="space-y-4">
                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4">
                    <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                    Î‘Î»Î»Î±Î³Î® Ï€ÏÎ¿Ï†Î¯Î» ÎºÎ±Î¹ ÎºÏ‰Î´Î¹ÎºÎ¿Ï Î³Î¯Î½ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î· ÏƒÎµÎ»Î¯Î´Î± Profile.
                </div>
            </div>
            
            <div x-show="activeTab === 'teams'" class="space-y-4">
                <h3 class="text-lg font-semibold mb-2">ÎŸÎ¹ ÎŸÎ¼Î¬Î´ÎµÏ‚ Î¼Î¿Ï…</h3>
                <p class="text-sm text-gray-500 mb-4">Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ Î¿Î¼Î¬Î´ÎµÏ‚ ÏƒÎ±Ï‚ Î±Ï€ÏŒ Ï„Î· ÏƒÎµÎ»Î¯Î´Î± Teams.</p>
                <a href="#teams" class="inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                    <i class="fas fa-users"></i>
                    ÎœÎµÏ„Î¬Î²Î±ÏƒÎ· ÏƒÏ„Î¹Ï‚ ÎŸÎ¼Î¬Î´ÎµÏ‚
                </a>
            </div>
            
            <div x-show="activeTab === 'preferences'" class="space-y-4">
                <p class="text-sm text-gray-500">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„Î¹Ï‚ Ï€ÏÎ¿Ï„Î¹Î¼Î®ÏƒÎµÎ¹Ï‚ ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î³Î»ÏÏƒÏƒÎ±Ï‚.</p>
            </div>
            
            <div x-show="activeTab === 'notifications'" class="space-y-4">
                <p class="text-sm text-gray-500">Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ ÏƒÎ±Ï‚.</p>
            </div>
        </div>
    </div>

    <!-- ADMIN Settings (Full Access) -->
    <div x-show="userRole === 'ADMIN'">
        
        <!-- Tab Navigation -->
        <div class="glass rounded-3xl p-2 mb-6">
            <div class="flex gap-2 flex-wrap">
                <button @click="activeTab = 'security'" 
                        :class="activeTab === 'security' ? 'bg-white text-red-600 shadow-lg' : 'text-gray-600 hover:bg-white hover:bg-opacity-50'"
                        class="flex-1 min-w-[150px] px-4 py-3 rounded-xl font-semibold transition text-sm">
                    <i class="fas fa-shield-alt mr-2"></i>
                    Security
                </button>
                <button @click="activeTab = 'appearance'" 
                        :class="activeTab === 'appearance' ? 'bg-white text-pink-600 shadow-lg' : 'text-gray-600 hover:bg-white hover:bg-opacity-50'"
                        class="flex-1 min-w-[150px] px-4 py-3 rounded-xl font-semibold transition text-sm">
                    <i class="fas fa-paint-brush mr-2"></i>
                    Appearance
                </button>
                <button @click="activeTab = 'system'" 
                        :class="activeTab === 'system' ? 'bg-white text-indigo-600 shadow-lg' : 'text-gray-600 hover:bg-white hover:bg-opacity-50'"
                        class="flex-1 min-w-[150px] px-4 py-3 rounded-xl font-semibold transition text-sm">
                    <i class="fas fa-cog mr-2"></i>
                    System
                </button>
                <button @click="activeTab = 'email'" 
                        :class="activeTab === 'email' ? 'bg-white text-blue-600 shadow-lg' : 'text-gray-600 hover:bg-white hover:bg-opacity-50'"
                        class="flex-1 min-w-[150px] px-4 py-3 rounded-xl font-semibold transition text-sm">
                    <i class="fas fa-envelope mr-2"></i>
                    Email / SMTP
                </button>
                <button @click="activeTab = 'notifications'" 
                        :class="activeTab === 'notifications' ? 'bg-white text-yellow-600 shadow-lg' : 'text-gray-600 hover:bg-white hover:bg-opacity-50'"
                        class="flex-1 min-w-[150px] px-4 py-3 rounded-xl font-semibold transition text-sm">
                    <i class="fas fa-bell mr-2"></i>
                    Notifications
                </button>
                <button @click="activeTab = 'maintenance'" 
                        :class="activeTab === 'maintenance' ? 'bg-white text-orange-600 shadow-lg' : 'text-gray-600 hover:bg-white hover:bg-opacity-50'"
                        class="flex-1 min-w-[150px] px-4 py-3 rounded-xl font-semibold transition text-sm">
                    <i class="fas fa-tools mr-2"></i>
                    Maintenance
                </button>
                <button @click="activeTab = 'retention'" 
                        :class="activeTab === 'retention' ? 'bg-white text-teal-600 shadow-lg' : 'text-gray-600 hover:bg-white hover:bg-opacity-50'"
                        class="flex-1 min-w-[150px] px-4 py-3 rounded-xl font-semibold transition text-sm">
                    <i class="fas fa-clock mr-2"></i>
                    Data Retention
                </button>
                <button @click="activeTab = 'preferences'" 
                        :class="activeTab === 'preferences' ? 'bg-white text-purple-600 shadow-lg' : 'text-gray-600 hover:bg-white hover:bg-opacity-50'"
                        class="flex-1 min-w-[150px] px-4 py-3 rounded-xl font-semibold transition text-sm">
                    <i class="fas fa-user-cog mr-2"></i>
                    Preferences
                </button>
                <button @click="activeTab = 'templates'" 
                        :class="activeTab === 'templates' ? 'bg-white text-green-600 shadow-lg' : 'text-gray-600 hover:bg-white hover:bg-opacity-50'"
                        class="flex-1 min-w-[150px] px-4 py-3 rounded-xl font-semibold transition text-sm">
                    <i class="fas fa-palette mr-2"></i>
                    Templates
                </button>
            </div>
        </div>

        <!-- Security Settings Tab -->
        <div x-show="activeTab === 'security'" class="glass rounded-3xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ” Security Settings</h2>
            
            <form @submit.prevent="saveSystemSettings('security')" class="space-y-6">
                <!-- Password Policies -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Password Policies</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">
                                Minimum Password Length
                            </label>
                            <input type="number" x-model="systemSettings.password_min_length" 
                                   min="6" max="20"
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-red-500 focus:ring-2 focus:ring-red-200">
                            <p class="text-xs text-gray-500 mt-1">Recommended: 8-12 characters</p>
                        </div>
                    </div>
                    
                    <div class="mt-4 space-y-3">
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" x-model="systemSettings.password_require_uppercase"
                                   class="w-5 h-5 text-red-600 rounded focus:ring-2 focus:ring-red-500">
                            <span class="font-medium text-gray-700">Require uppercase letters (A-Z)</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" x-model="systemSettings.password_require_lowercase"
                                   class="w-5 h-5 text-red-600 rounded focus:ring-2 focus:ring-red-500">
                            <span class="font-medium text-gray-700">Require lowercase letters (a-z)</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" x-model="systemSettings.password_require_numbers"
                                   class="w-5 h-5 text-red-600 rounded focus:ring-2 focus:ring-red-500">
                            <span class="font-medium text-gray-700">Require numbers (0-9)</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" x-model="systemSettings.password_require_special"
                                   class="w-5 h-5 text-red-600 rounded focus:ring-2 focus:ring-red-500">
                            <span class="font-medium text-gray-700">Require special characters (!@#$%^&*)</span>
                        </label>
                    </div>
                </div>
                
                <!-- Session & Login -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Session & Login Security</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">
                                Session Timeout (minutes)
                            </label>
                            <input type="number" x-model="systemSettings.session_timeout" 
                                   min="15" max="1440"
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-red-500 focus:ring-2 focus:ring-red-200">
                            <p class="text-xs text-gray-500 mt-1">Default: 1440 (24 hours)</p>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">
                                Max Login Attempts
                            </label>
                            <input type="number" x-model="systemSettings.max_login_attempts" 
                                   min="3" max="10"
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-red-500 focus:ring-2 focus:ring-red-200">
                            <p class="text-xs text-gray-500 mt-1">Before account lockout</p>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">
                                Lockout Duration (minutes)
                            </label>
                            <input type="number" x-model="systemSettings.lockout_duration" 
                                   min="5" max="60"
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-red-500 focus:ring-2 focus:ring-red-200">
                            <p class="text-xs text-gray-500 mt-1">Account lock time</p>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" 
                            class="px-8 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl font-semibold hover:from-red-600 hover:to-red-700 shadow-lg transition">
                        <i class="fas fa-save mr-2"></i>
                        Save Security Settings
                    </button>
                </div>
            </form>
        </div>

        <!-- Appearance & Localization Tab -->
        <div x-show="activeTab === 'appearance'" class="glass rounded-3xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ¨ Appearance & Localization</h2>
            
            <form @submit.prevent="saveSystemSettings('appearance')" class="space-y-6">
                <!-- Logo Upload -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Branding</h3>
                    
                    <div class="flex items-start gap-6">
                        <div class="w-32 h-32 border-2 border-dashed border-gray-300 rounded-xl flex items-center justify-center bg-gray-50">
                            <img x-show="systemSettings.logo_path" :src="systemSettings.logo_path" class="w-full h-full object-contain rounded-xl">
                            <i x-show="!systemSettings.logo_path" class="fas fa-image text-4xl text-gray-400"></i>
                        </div>
                        <div class="flex-1">
                            <label class="block text-gray-700 font-semibold mb-2">Upload Logo</label>
                            <input type="file" @change="uploadLogo" accept="image/png,image/jpeg,image/jpg"
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-pink-500 focus:ring-2 focus:ring-pink-200">
                            <p class="text-xs text-gray-500 mt-2">PNG or JPG, max 2MB. Recommended: 200x200px</p>
                            <button type="button" @click="removeLogo" x-show="systemSettings.logo_path"
                                    class="mt-2 text-red-600 hover:text-red-700 text-sm font-semibold">
                                <i class="fas fa-trash mr-1"></i> Remove Logo
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Date & Time Format -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Date & Time</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Date Format</label>
                            <select x-model="systemSettings.date_format"
                                    class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-pink-500 focus:ring-2 focus:ring-pink-200">
                                <option value="DD/MM/YYYY">DD/MM/YYYY (31/12/2025)</option>
                                <option value="MM/DD/YYYY">MM/DD/YYYY (12/31/2025)</option>
                                <option value="YYYY-MM-DD">YYYY-MM-DD (2025-12-31)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Time Format</label>
                            <select x-model="systemSettings.time_format"
                                    class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-pink-500 focus:ring-2 focus:ring-pink-200">
                                <option value="24h">24-hour (14:30)</option>
                                <option value="12h">12-hour (2:30 PM)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Timezone</label>
                            <select x-model="systemSettings.timezone"
                                    class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-pink-500 focus:ring-2 focus:ring-pink-200">
                                <option value="Europe/Athens">Europe/Athens (GMT+2)</option>
                                <option value="Europe/London">Europe/London (GMT+0)</option>
                                <option value="America/New_York">America/New_York (GMT-5)</option>
                                <option value="America/Los_Angeles">America/Los_Angeles (GMT-8)</option>
                                <option value="Asia/Tokyo">Asia/Tokyo (GMT+9)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Language & Colors -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Language & Colors</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Default Language</label>
                            <select x-model="systemSettings.language"
                                    class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-pink-500 focus:ring-2 focus:ring-pink-200">
                                <option value="el">Î•Î»Î»Î·Î½Î¹ÎºÎ¬ (Greek)</option>
                                <option value="en">English</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Primary Color</label>
                            <input type="color" x-model="systemSettings.primary_color"
                                   class="w-full h-12 rounded-xl border border-gray-300 focus:border-pink-500 focus:ring-2 focus:ring-pink-200">
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" 
                            class="px-8 py-3 bg-gradient-to-r from-pink-500 to-pink-600 text-white rounded-xl font-semibold hover:from-pink-600 hover:to-pink-700 shadow-lg transition">
                        <i class="fas fa-save mr-2"></i>
                        Save Appearance Settings
                    </button>
                </div>
            </form>
        </div>

        <!-- System Configuration Tab -->
        <div x-show="activeTab === 'system'" class="glass rounded-3xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">âš™ï¸ System Configuration</h2>
            
            <form @submit.prevent="saveSystemSettings('system')" class="space-y-6">
                
                <!-- Installation Path (NEW) -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">
                        <i class="fas fa-folder text-indigo-600 mr-2"></i>Installation Path
                    </h3>
                    
                    <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4 mb-4">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-info-circle text-blue-600 mt-1"></i>
                            <div class="flex-1">
                                <p class="text-sm text-gray-700 dark:text-gray-300 mb-2">
                                    <strong>Auto-Detection Active:</strong> The system automatically detects the installation path.
                                </p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    â€¢ Leave empty for root installation (e.g., <code>http://domain.com/</code>)<br>
                                    â€¢ Enter <code>/task</code> for subdirectory (e.g., <code>http://domain.com/task/</code>)<br>
                                    â€¢ Current detected path: <strong x-text="'&quot;' + (systemSettings.installation_path || '/ (root)') + '&quot;'"></strong>
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">
                            Installation Path (Optional Override)
                        </label>
                        <div class="flex gap-2">
                            <input type="text" 
                                   x-model="systemSettings.installation_path" 
                                   placeholder="/task or leave empty for root"
                                   class="flex-1 px-4 py-3 rounded-xl border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200">
                            <button type="button" 
                                    @click="detectInstallationPath()"
                                    class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-semibold transition">
                                <i class="fas fa-sync-alt mr-2"></i>Auto-Detect
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">
                            ğŸ’¡ <strong>Tip:</strong> Only change this if you move the application to a different directory.
                        </p>
                    </div>
                </div>
                
                <!-- Tasks & Auto-Archive -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Task Management</h3>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">
                            Auto-Archive Completed Tasks (days)
                        </label>
                        <input type="number" x-model="systemSettings.task_auto_archive_days" 
                               min="7" max="365"
                               class="w-full md:w-1/2 px-4 py-3 rounded-xl border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200">
                        <p class="text-xs text-gray-500 mt-1">Automatically archive tasks after X days of completion (0 = disabled)</p>
                    </div>
                </div>
                
                <!-- User Registration -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">User Registration</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Registration Mode</label>
                            <select x-model="systemSettings.registration_mode"
                                    class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200">
                                <option value="open">Open (Anyone can register)</option>
                                <option value="invite">Invite Only (Requires invitation)</option>
                                <option value="disabled">Disabled (No new registrations)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Default User Role</label>
                            <select x-model="systemSettings.default_user_role"
                                    class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200">
                                <option value="USER">USER</option>
                                <option value="MANAGER">MANAGER</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Team Settings -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Team Settings</h3>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">Maximum Team Size</label>
                        <input type="number" x-model="systemSettings.max_team_size" 
                               min="5" max="100"
                               class="w-full md:w-1/2 px-4 py-3 rounded-xl border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200">
                        <p class="text-xs text-gray-500 mt-1">Maximum number of members per team</p>
                    </div>
                </div>
                
                <!-- File Upload Settings -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">File Upload Settings</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Max Upload Size (MB)</label>
                            <input type="number" x-model="systemSettings.max_file_upload_mb" 
                                   min="1" max="100"
                                   class="w-full md:w-1/2 px-4 py-3 rounded-xl border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200">
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Allowed File Types</label>
                            <input type="text" x-model="systemSettings.allowed_file_types"
                                   placeholder="jpg,png,pdf,doc,docx"
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200">
                            <p class="text-xs text-gray-500 mt-1">Comma-separated list of allowed extensions</p>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" 
                            class="px-8 py-3 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white rounded-xl font-semibold hover:from-indigo-600 hover:to-indigo-700 shadow-lg transition">
                        <i class="fas fa-save mr-2"></i>
                        Save System Settings
                    </button>
                </div>
            </form>
        </div>

        <!-- Notifications Configuration Tab -->
        <div x-show="activeTab === 'notifications'" class="glass rounded-3xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ”” Notifications Configuration</h2>
            
            <form @submit.prevent="saveSystemSettings('notifications')" class="space-y-6">
                <!-- Notification System Info -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Notification System</h3>
                    
                    <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-xl">
                        <div class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 text-xl mt-0.5 mr-3"></i>
                            <div>
                                <p class="font-semibold text-green-800">Polling-Based Notifications</p>
                                <p class="text-sm text-green-700">System checks for new notifications every 30 seconds automatically.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Delivery Methods -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Notification Delivery Methods</h3>
                    
                    <div class="space-y-3">
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" x-model="systemSettings.notification_email"
                                   class="w-5 h-5 text-yellow-600 rounded focus:ring-2 focus:ring-yellow-500">
                            <div>
                                <span class="font-medium text-gray-700">Email Notifications</span>
                                <p class="text-xs text-gray-500">Send notifications via email (configure SMTP in Email/SMTP tab)</p>
                            </div>
                        </label>
                        
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" x-model="systemSettings.notification_inapp"
                                   class="w-5 h-5 text-yellow-600 rounded focus:ring-2 focus:ring-yellow-500">
                            <div>
                                <span class="font-medium text-gray-700">In-App Notifications</span>
                                <p class="text-xs text-gray-500">Show notifications in the dashboard</p>
                            </div>
                        </label>
                        
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" x-model="systemSettings.notification_push"
                                   class="w-5 h-5 text-yellow-600 rounded focus:ring-2 focus:ring-yellow-500">
                            <div>
                                <span class="font-medium text-gray-700">Browser Push Notifications</span>
                                <p class="text-xs text-gray-500">Send push notifications to user's browser</p>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Batching Settings -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Notification Batching</h3>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">Batch Mode</label>
                        <select x-model="systemSettings.notification_batch_mode"
                                class="w-full md:w-1/2 px-4 py-3 rounded-xl border border-gray-300 focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200">
                            <option value="immediate">Immediate (Send right away)</option>
                            <option value="5min">Every 5 minutes</option>
                            <option value="15min">Every 15 minutes</option>
                            <option value="hourly">Hourly</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">Group notifications to reduce email/push frequency</p>
                    </div>
                </div>
                
                <!-- Quiet Hours -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Quiet Hours</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Start Time</label>
                            <input type="time" x-model="systemSettings.quiet_hours_start"
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200">
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">End Time</label>
                            <input type="time" x-model="systemSettings.quiet_hours_end"
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200">
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Suppress notifications during these hours (leave empty to disable)</p>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" 
                            class="px-8 py-3 bg-gradient-to-r from-yellow-500 to-yellow-600 text-white rounded-xl font-semibold hover:from-yellow-600 hover:to-yellow-700 shadow-lg transition">
                        <i class="fas fa-save mr-2"></i>
                        Save Notification Settings
                    </button>
                </div>
            </form>
        </div>

        <!-- Maintenance & Tools Tab -->
        <div x-show="activeTab === 'maintenance'" class="glass rounded-3xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ› ï¸ Maintenance & Tools</h2>
            
            <div class="space-y-6">
                <!-- System Health -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">System Health</h3>
                    
                    <div class="bg-gray-50 rounded-xl p-4 space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="font-medium">Database Status:</span>
                            <span x-text="healthCheck.database" class="px-3 py-1 rounded-full text-sm font-semibold"
                                  :class="healthCheck.database === 'OK' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'"></span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="font-medium">WebSocket Server:</span>
                            <span x-text="healthCheck.websocket" class="px-3 py-1 rounded-full text-sm font-semibold"
                                  :class="healthCheck.websocket === 'Running' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'"></span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="font-medium">Disk Space:</span>
                            <span x-text="healthCheck.disk" class="px-3 py-1 rounded-full text-sm font-semibold bg-blue-100 text-blue-800"></span>
                        </div>
                    </div>
                    
                    <button @click="runHealthCheck" 
                            class="mt-4 px-6 py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 shadow-lg transition">
                        <i class="fas fa-heartbeat mr-2"></i>
                        Run Health Check
                    </button>
                </div>
                
                <!-- Database Tools -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Database Tools</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button @click="optimizeDatabase" 
                                class="px-6 py-4 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-xl font-semibold hover:from-purple-600 hover:to-purple-700 shadow-lg transition">
                            <i class="fas fa-database mr-2"></i>
                            Optimize Database
                        </button>
                        
                        <button @click="clearCache" 
                                class="px-6 py-4 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl font-semibold hover:from-orange-600 hover:to-orange-700 shadow-lg transition">
                            <i class="fas fa-broom mr-2"></i>
                            Clear Cache
                        </button>
                    </div>
                    
                    <p class="text-xs text-gray-500 mt-2">Last optimization: <span x-text="systemSettings.last_optimization || 'Never'"></span></p>
                </div>
                
                <!-- Backup & Restore -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Backup & Restore</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <button @click="createBackup" 
                                class="px-6 py-4 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-semibold hover:from-green-600 hover:to-green-700 shadow-lg transition">
                            <i class="fas fa-download mr-2"></i>
                            Create Backup
                        </button>
                        
                        <button @click="restoreBackup" 
                                class="px-6 py-4 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl font-semibold hover:from-red-600 hover:to-red-700 shadow-lg transition">
                            <i class="fas fa-upload mr-2"></i>
                            Restore Backup
                        </button>
                    </div>
                    
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" x-model="systemSettings.auto_backup_enabled"
                               @change="saveSystemSettings('maintenance')"
                               class="w-5 h-5 text-green-600 rounded focus:ring-2 focus:ring-green-500">
                        <span class="font-medium text-gray-700">Enable automatic backups</span>
                    </label>
                    
                    <div x-show="systemSettings.auto_backup_enabled" class="mt-3">
                        <select x-model="systemSettings.backup_frequency"
                                @change="saveSystemSettings('maintenance')"
                                class="w-full md:w-1/2 px-4 py-3 rounded-xl border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                    
                    <p class="text-xs text-gray-500 mt-2">Last backup: <span x-text="systemSettings.last_backup || 'Never'"></span></p>
                </div>
                
                <!-- Import/Export -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Import / Export Data</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button @click="exportData" 
                                class="px-6 py-4 bg-gradient-to-r from-cyan-500 to-cyan-600 text-white rounded-xl font-semibold hover:from-cyan-600 hover:to-cyan-700 shadow-lg transition">
                            <i class="fas fa-file-export mr-2"></i>
                            Export All Data (JSON)
                        </button>
                        
                        <button @click="importData" 
                                class="px-6 py-4 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white rounded-xl font-semibold hover:from-indigo-600 hover:to-indigo-700 shadow-lg transition">
                            <i class="fas fa-file-import mr-2"></i>
                            Import Data
                        </button>
                    </div>
                </div>
                
                <!-- Maintenance Mode -->
                <div>
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Maintenance Mode</h3>
                    
                    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-xl mb-4">
                        <p class="text-sm text-yellow-800">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            Enabling maintenance mode will prevent all users (except admins) from accessing the system.
                        </p>
                    </div>
                    
                    <label class="flex items-center gap-3 cursor-pointer mb-4">
                        <input type="checkbox" x-model="systemSettings.maintenance_mode"
                               @change="toggleMaintenanceMode"
                               class="w-5 h-5 text-orange-600 rounded focus:ring-2 focus:ring-orange-500">
                        <span class="font-medium text-gray-700" :class="systemSettings.maintenance_mode ? 'text-orange-600' : ''">
                            Enable Maintenance Mode
                        </span>
                    </label>
                    
                    <div x-show="systemSettings.maintenance_mode">
                        <label class="block text-gray-700 font-semibold mb-2">Maintenance Message</label>
                        <textarea x-model="systemSettings.maintenance_message"
                                  rows="3"
                                  class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Email Settings Tab (SMTP) -->
        <div x-show="activeTab === 'email'" class="glass rounded-3xl p-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">ğŸ“§ SMTP Configuration</h2>
                <div class="flex items-center gap-3">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" x-model="emailSettings.notifications_enabled" 
                               @change="saveEmailSettings()"
                               class="w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500">
                        <span class="font-semibold" :class="emailSettings.notifications_enabled ? 'text-green-600' : 'text-gray-500'">
                            <i class="fas" :class="emailSettings.notifications_enabled ? 'fa-check-circle' : 'fa-times-circle'"></i>
                            <span x-text="emailSettings.notifications_enabled ? 'Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î±' : 'Î‘Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î±'"></span>
                        </span>
                    </label>
                </div>
            </div>

            <!-- Info Banner -->
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded-xl">
                <div class="flex items-start">
                    <i class="fas fa-info-circle text-blue-500 text-xl mt-0.5 mr-3"></i>
                    <div class="text-sm text-blue-800">
                        <p class="font-semibold mb-1">ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Gmail App Password:</p>
                        <ol class="list-decimal list-inside space-y-1">
                            <li>Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎµ 2FA: <a href="https://myaccount.google.com/security" target="_blank" class="underline">Google Security</a></li>
                            <li>Î”Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ App Password: <a href="https://myaccount.google.com/apppasswords" target="_blank" class="underline">App Passwords</a></li>
                            <li>Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎµ Ï„Î¿ 16-character password Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰</li>
                        </ol>
                    </div>
                </div>
            </div>
            
            <form @submit.prevent="saveEmailSettings" class="space-y-6">
                <!-- SMTP Configuration -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">SMTP Server</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">
                                SMTP Host <span class="text-red-500">*</span>
                            </label>
                            <input type="text" x-model="emailSettings.smtp_host" 
                                   placeholder="smtp.gmail.com"
                                   required
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">
                                SMTP Port <span class="text-red-500">*</span>
                            </label>
                            <input type="number" x-model="emailSettings.smtp_port" 
                                   placeholder="587"
                                   required
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                        </div>
                    </div>

                    <div class="mt-4">
                        <label class="block text-gray-700 font-semibold mb-2">Encryption</label>
                        <select x-model="emailSettings.smtp_encryption"
                                class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                            <option value="tls">TLS (Recommended)</option>
                            <option value="ssl">SSL</option>
                        </select>
                    </div>
                </div>

                <!-- Authentication -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Authentication</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">
                                SMTP Username (Email) <span class="text-red-500">*</span>
                            </label>
                            <input type="email" x-model="emailSettings.smtp_username" 
                                   placeholder="your-email@gmail.com"
                                   required
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">
                                SMTP Password <span class="text-red-500">*</span>
                                <span x-show="emailSettings.password_is_set" class="text-green-600 text-sm font-normal">
                                    <i class="fas fa-check-circle"></i> Password is set
                                </span>
                            </label>
                            <input type="password" x-model="emailSettings.smtp_password" 
                                   :placeholder="emailSettings.password_is_set ? 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' : 'App Password (16 characters)'"
                                   :required="!emailSettings.password_is_set"
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                        </div>
                    </div>
                </div>

                <!-- Email Display Settings -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Email Display</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">From Email</label>
                            <input type="email" x-model="emailSettings.smtp_from_email" 
                                   placeholder="noreply@yourdomain.com"
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">From Name</label>
                            <input type="text" x-model="emailSettings.smtp_from_name" 
                                   placeholder="TaskMesh Notifications"
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                        </div>

                    </div>
                </div>

                <!-- Test Email Section -->
                <div class="bg-gray-50 rounded-xl p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ§ª Test Email</h3>
                    <div class="flex gap-3">
                        <input type="email" x-model="testEmailAddress" 
                               placeholder="Enter email to send test"
                               class="flex-1 px-4 py-3 rounded-xl border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200">
                        <button type="button" @click="testEmail" :disabled="testingEmail || !testEmailAddress"
                                class="px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white font-semibold rounded-xl hover:shadow-lg transition disabled:opacity-50 whitespace-nowrap">
                            <span x-show="!testingEmail"><i class="fas fa-paper-plane mr-2"></i>Send Test</span>
                            <span x-show="testingEmail"><i class="fas fa-spinner fa-spin mr-2"></i>Sending...</span>
                        </button>
                    </div>
                </div>

                <!-- Messages -->
                <div x-show="emailError" x-transition class="bg-red-100 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded-xl" x-text="emailError"></div>
                <div x-show="emailSuccess" x-transition class="bg-green-100 border-l-4 border-green-500 text-green-700 px-4 py-3 rounded-xl" x-text="emailSuccess"></div>

                <!-- Actions -->
                <div class="flex gap-3 pt-4">
                    <button type="submit" :disabled="savingEmail"
                            class="px-8 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-semibold rounded-xl hover:shadow-lg transition disabled:opacity-50">
                        <span x-show="!savingEmail"><i class="fas fa-save mr-2"></i>Save Settings</span>
                        <span x-show="savingEmail"><i class="fas fa-spinner fa-spin mr-2"></i>Saving...</span>
                    </button>
                </div>
            </form>
        </div>

        <!-- Data Retention Tab -->
        <div x-show="activeTab === 'retention'" class="glass rounded-3xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ•’ Data Retention Policies</h2>
            
            <form @submit.prevent="saveSystemSettings('retention')" class="space-y-6">
                <!-- Info Banner -->
                <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-6 rounded-xl">
                    <div class="flex items-start">
                        <i class="fas fa-exclamation-triangle text-yellow-500 text-xl mt-0.5 mr-3"></i>
                        <div class="text-sm text-yellow-800">
                            <p class="font-semibold mb-1">Automatic Data Cleanup</p>
                            <p>Configure how long to keep old data before automatic deletion. Set to 0 to disable automatic cleanup for that item.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Task Retention -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Task Retention</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">
                                Auto-archive completed tasks after (days)
                            </label>
                            <input type="number" x-model="systemSettings.archive_completed_tasks_days" 
                                   min="0" max="365"
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-teal-500 focus:ring-2 focus:ring-teal-200">
                            <p class="text-xs text-gray-500 mt-1">Completed tasks will be archived and hidden from view (0 = disabled)</p>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">
                                Permanently delete archived tasks after (days)
                            </label>
                            <input type="number" x-model="systemSettings.delete_archived_tasks_days" 
                                   min="0" max="3650"
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-teal-500 focus:ring-2 focus:ring-teal-200">
                            <p class="text-xs text-gray-500 mt-1">Archived tasks will be permanently deleted (0 = never delete)</p>
                        </div>
                    </div>
                </div>
                
                <!-- User Retention -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">User Account Retention</h3>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">
                            Delete inactive user accounts after (months)
                        </label>
                        <input type="number" x-model="systemSettings.delete_inactive_users_months" 
                               min="0" max="60"
                               class="w-full md:w-1/2 px-4 py-3 rounded-xl border border-gray-300 focus:border-teal-500 focus:ring-2 focus:ring-teal-200">
                        <p class="text-xs text-gray-500 mt-1">Users who haven't logged in will be deleted (0 = disabled, recommended: 12-24 months)</p>
                    </div>
                </div>
                
                <!-- Notification Retention -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Notification & Comment Retention</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">
                                Clean old notifications after (days)
                            </label>
                            <input type="number" x-model="systemSettings.clean_old_notifications_days" 
                                   min="0" max="365"
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-teal-500 focus:ring-2 focus:ring-teal-200">
                            <p class="text-xs text-gray-500 mt-1">Read notifications older than this will be deleted (0 = disabled)</p>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">
                                Clean old comments after (days)
                            </label>
                            <input type="number" x-model="systemSettings.clean_old_comments_days" 
                                   min="0" max="3650"
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-teal-500 focus:ring-2 focus:ring-teal-200">
                            <p class="text-xs text-gray-500 mt-1">Comments on deleted tasks will be removed (0 = keep forever)</p>
                        </div>
                    </div>
                </div>
                
                <!-- Cleanup Status -->
                <div class="bg-gray-50 rounded-xl p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Cleanup Status</h3>
                    
                    <div class="space-y-2">
                        <p class="text-sm text-gray-700">
                            <span class="font-semibold">Last cleanup run:</span> 
                            <span x-text="systemSettings.last_retention_cleanup || 'Never'"></span>
                        </p>
                        <button type="button" @click="runRetentionCleanup"
                                class="px-6 py-3 bg-gradient-to-r from-teal-500 to-teal-600 text-white rounded-xl font-semibold hover:from-teal-600 hover:to-teal-700 shadow-lg transition">
                            <i class="fas fa-broom mr-2"></i>
                            Run Cleanup Now
                        </button>
                        <p class="text-xs text-gray-500 mt-2">
                            <i class="fas fa-info-circle mr-1"></i>
                            Cleanup runs automatically daily at midnight. You can also run it manually here.
                        </p>
                    </div>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" 
                            class="px-8 py-3 bg-gradient-to-r from-teal-500 to-teal-600 text-white rounded-xl font-semibold hover:from-teal-600 hover:to-teal-700 shadow-lg transition">
                        <i class="fas fa-save mr-2"></i>
                        Save Retention Settings
                    </button>
                </div>
            </form>
        </div>

        <!-- Email Preferences Tab -->
        <div x-show="activeTab === 'preferences'" class="glass rounded-3xl p-8">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">ğŸ”” Email Preferences</h2>
                    <p class="text-gray-600 mt-1">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï€Î¿Î¹Î± emails Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î»Î±Î¼Î²Î¬Î½ÎµÏ„Îµ</p>
                </div>
            </div>

            <form @submit.prevent="savePreferences" class="space-y-6">
                <!-- Notification Types -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Î¤ÏÏ€Î¿Î¹ Î•Î¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ‰Î½</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <label class="flex items-center gap-3 p-4 bg-white rounded-xl border border-gray-200 hover:border-purple-300 transition cursor-pointer">
                            <input type="checkbox" x-model="preferences.notify_task_assigned" 
                                   class="w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500">
                            <div>
                                <span class="font-semibold text-gray-800">ğŸ“‹ Î‘Î½Î¬Î¸ÎµÏƒÎ· Task</span>
                                <p class="text-sm text-gray-500">ÎŒÏ„Î±Î½ ÏƒÎ±Ï‚ Î±Î½Î±Ï„Î¯Î¸ÎµÏ„Î±Î¹ Î½Î­Î¿ task</p>
                            </div>
                        </label>

                        <label class="flex items-center gap-3 p-4 bg-white rounded-xl border border-gray-200 hover:border-purple-300 transition cursor-pointer">
                            <input type="checkbox" x-model="preferences.notify_task_completed" 
                                   class="w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500">
                            <div>
                                <span class="font-semibold text-gray-800">âœ… ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ· Task</span>
                                <p class="text-sm text-gray-500">ÎŒÏ„Î±Î½ Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ½ÎµÏ„Î±Î¹ Î­Î½Î± task</p>
                            </div>
                        </label>

                        <label class="flex items-center gap-3 p-4 bg-white rounded-xl border border-gray-200 hover:border-purple-300 transition cursor-pointer">
                            <input type="checkbox" x-model="preferences.notify_subtask_created" 
                                   class="w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500">
                            <div>
                                <span class="font-semibold text-gray-800">ğŸ“ ÎÎ­Î¿ Subtask</span>
                                <p class="text-sm text-gray-500">ÎŒÏ„Î±Î½ Ï€ÏÎ¿ÏƒÏ„Î¯Î¸ÎµÏ„Î±Î¹ Î½Î­Î¿ subtask</p>
                            </div>
                        </label>

                        <label class="flex items-center gap-3 p-4 bg-white rounded-xl border border-gray-200 hover:border-purple-300 transition cursor-pointer">
                            <input type="checkbox" x-model="preferences.notify_subtask_completed" 
                                   class="w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500">
                            <div>
                                <span class="font-semibold text-gray-800">â˜‘ï¸ ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ· Subtask</span>
                                <p class="text-sm text-gray-500">ÎŒÏ„Î±Î½ Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ½ÎµÏ„Î±Î¹ Î­Î½Î± subtask</p>
                            </div>
                        </label>

                        <label class="flex items-center gap-3 p-4 bg-white rounded-xl border border-gray-200 hover:border-purple-300 transition cursor-pointer">
                            <input type="checkbox" x-model="preferences.notify_comment_added" 
                                   class="w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500">
                            <div>
                                <span class="font-semibold text-gray-800">ğŸ’¬ ÎÎ­Î¿ Î£Ï‡ÏŒÎ»Î¹Î¿</span>
                                <p class="text-sm text-gray-500">ÎŒÏ„Î±Î½ Ï€ÏÎ¿ÏƒÏ„Î¯Î¸ÎµÏ„Î±Î¹ ÏƒÏ‡ÏŒÎ»Î¹Î¿ ÏƒÎµ task</p>
                            </div>
                        </label>

                        <label class="flex items-center gap-3 p-4 bg-white rounded-xl border border-gray-200 hover:border-purple-300 transition cursor-pointer">
                            <input type="checkbox" x-model="preferences.notify_deadline_reminder" 
                                   class="w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500">
                            <div>
                                <span class="font-semibold text-gray-800">â° Deadline Reminder</span>
                                <p class="text-sm text-gray-500">Î¥Ï€ÎµÎ½Î¸ÏÎ¼Î¹ÏƒÎ· Î³Î¹Î± deadlines</p>
                            </div>
                        </label>

                        <label class="flex items-center gap-3 p-4 bg-white rounded-xl border border-gray-200 hover:border-purple-300 transition cursor-pointer">
                            <input type="checkbox" x-model="preferences.notify_team_invitation" 
                                   class="w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500">
                            <div>
                                <span class="font-semibold text-gray-800">ğŸ‘¥ Î ÏÏŒÏƒÎºÎ»Î·ÏƒÎ· ÏƒÎµ ÎŸÎ¼Î¬Î´Î±</span>
                                <p class="text-sm text-gray-500">ÎŒÏ„Î±Î½ Ï€ÏÎ¿ÏƒÏ„Î¯Î¸ÎµÏƒÏ„Îµ ÏƒÎµ Î¿Î¼Î¬Î´Î±</p>
                            </div>
                        </label>

                        <label class="flex items-center gap-3 p-4 bg-white rounded-xl border border-gray-200 hover:border-purple-300 transition cursor-pointer">
                            <input type="checkbox" x-model="preferences.notify_direct_message" 
                                   class="w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500">
                            <div>
                                <span class="font-semibold text-gray-800">ğŸ“¨ Direct Message</span>
                                <p class="text-sm text-gray-500">ÎŒÏ„Î±Î½ Î»Î±Î¼Î²Î¬Î½ÎµÏ„Îµ Î¼Î®Î½Ï…Î¼Î±</p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Team Filter -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Î¦Î¯Î»Ï„ÏÎ¿ ÎŸÎ¼Î¬Î´Ï‰Î½</h3>
                    <p class="text-gray-600 mb-4">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Ï€ÏŒ Ï€Î¿Î¹ÎµÏ‚ Î¿Î¼Î¬Î´ÎµÏ‚ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î»Î±Î¼Î²Î¬Î½ÎµÏ„Îµ ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚</p>
                    
                    <div class="space-y-3">
                        <label class="flex items-center gap-3 p-4 bg-purple-50 rounded-xl border border-purple-200 cursor-pointer">
                            <input type="radio" x-model="preferences.team_filter" value="all"
                                   class="w-5 h-5 text-purple-600 focus:ring-2 focus:ring-purple-500">
                            <div>
                                <span class="font-semibold text-gray-800">ğŸŒ ÎŒÎ»ÎµÏ‚ Î¿Î¹ ÎŸÎ¼Î¬Î´ÎµÏ‚</span>
                                <p class="text-sm text-gray-500">Î›Î±Î¼Î²Î¬Î½ÎµÏ„Îµ ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î¿Î¼Î¬Î´ÎµÏ‚</p>
                            </div>
                        </label>

                        <label class="flex items-center gap-3 p-4 bg-white rounded-xl border border-gray-200 cursor-pointer">
                            <input type="radio" x-model="preferences.team_filter" value="selected"
                                   class="w-5 h-5 text-purple-600 focus:ring-2 focus:ring-purple-500">
                            <div>
                                <span class="font-semibold text-gray-800">ğŸ¯ Î•Ï€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ ÎŸÎ¼Î¬Î´ÎµÏ‚</span>
                                <p class="text-sm text-gray-500">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Î¿Î¼Î¬Î´ÎµÏ‚</p>
                            </div>
                        </label>
                    </div>

                    <!-- Team Selection -->
                    <div x-show="preferences.team_filter === 'selected'" class="mt-4 p-4 bg-gray-50 rounded-xl">
                        <p class="text-sm text-gray-600 mb-3">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„Î¹Ï‚ Î¿Î¼Î¬Î´ÎµÏ‚:</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                            <template x-for="team in teams" :key="team.id">
                                <label class="flex items-center gap-2 p-2 bg-white rounded-lg border hover:border-purple-300 cursor-pointer">
                                    <input type="checkbox" :value="team.id" x-model="preferences.selected_teams"
                                           class="w-4 h-4 text-purple-600 rounded focus:ring-2 focus:ring-purple-500">
                                    <span class="w-3 h-3 rounded-full" :style="'background-color: ' + team.color"></span>
                                    <span class="text-gray-800" x-text="team.name"></span>
                                </label>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Email Digest -->
                <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Î£Ï…Ï‡Î½ÏŒÏ„Î·Ï„Î± Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®Ï‚</h3>
                    
                    <select x-model="preferences.email_digest"
                            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200">
                        <option value="instant">âš¡ Î†Î¼ÎµÏƒÎ± - ÎšÎ¬Î¸Îµ ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î¾ÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„Î¬</option>
                        <option value="daily">ğŸ“… Î—Î¼ÎµÏÎ®ÏƒÎ¹Î± Î£ÏÎ½Î¿ÏˆÎ· - ÎœÎ¯Î± Ï†Î¿ÏÎ¬ Ï„Î·Î½ Î·Î¼Î­ÏÎ±</option>
                        <option value="weekly">ğŸ“† Î•Î²Î´Î¿Î¼Î±Î´Î¹Î±Î¯Î± Î£ÏÎ½Î¿ÏˆÎ· - ÎœÎ¯Î± Ï†Î¿ÏÎ¬ Ï„Î·Î½ ÎµÎ²Î´Î¿Î¼Î¬Î´Î±</option>
                        <option value="none">ğŸ”• ÎšÎ±Î¼Î¯Î± - Î§Ï‰ÏÎ¯Ï‚ emails</option>
                    </select>
                </div>

                <!-- Cron Job / Scheduled Task Setup -->
                <div class="pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">
                        <span x-show="isLocalhost()">ğŸ–¥ï¸ Windows Task Scheduler Setup</span>
                        <span x-show="!isLocalhost()">ğŸ§ Linux Cron Job Setup</span>
                    </h3>
                    
                    <!-- Server Type Badge -->
                    <div class="mb-4">
                        <span class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-semibold"
                              :class="isLocalhost() ? 'bg-blue-100 text-blue-700' : 'bg-green-100 text-green-700'">
                            <i :class="isLocalhost() ? 'fab fa-windows' : 'fab fa-linux'"></i>
                            <span x-text="getServerType()"></span>
                        </span>
                    </div>
                    
                    <p class="text-gray-600 mb-4">Î“Î¹Î± Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î±Ï€Î¿ÏƒÏ„Î¿Î»Î® deadline reminders, ÏÏ…Î¸Î¼Î¯ÏƒÏ„Îµ Î¼Î¹Î± Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î­Î½Î· ÎµÏÎ³Î±ÏƒÎ¯Î±:</p>
                    
                    <!-- Frequency Selection -->
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î£Ï…Ï‡Î½ÏŒÏ„Î·Ï„Î±</label>
                        <select x-model="cronFrequency"
                                class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200">
                            <option value="hourly">â° ÎšÎ¬Î¸Îµ ÏÏÎ±</option>
                            <option value="every30min">â±ï¸ ÎšÎ¬Î¸Îµ 30 Î»ÎµÏ€Ï„Î¬</option>
                            <option value="daily9am">ğŸŒ… 1 Ï†Î¿ÏÎ¬/Î·Î¼Î­ÏÎ± (9:00 Ï€Î¼)</option>
                            <option value="daily9pm">ğŸŒ™ 1 Ï†Î¿ÏÎ¬/Î·Î¼Î­ÏÎ± (21:00)</option>
                            <option value="twice">ğŸ”„ 2 Ï†Î¿ÏÎ­Ï‚/Î·Î¼Î­ÏÎ± (9:00 & 17:00)</option>
                            <option value="every6hours">ğŸ“Š ÎšÎ¬Î¸Îµ 6 ÏÏÎµÏ‚</option>
                        </select>
                    </div>

                    <!-- Dynamic Command Display -->
                    <div class="bg-gray-900 rounded-xl p-4 mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-green-400 text-sm font-mono" x-text="isLocalhost() ? 'Windows Command:' : 'Linux Cron Command:'"></span>
                            <button @click="copyCronCommand()" class="text-gray-400 hover:text-white transition">
                                <i class="fas fa-copy"></i>
                                <span class="ml-1 text-xs">Copy</span>
                            </button>
                        </div>
                        <pre class="text-yellow-300 text-sm font-mono break-all whitespace-pre-wrap" x-text="getCronCommand()"></pre>
                    </div>

                    <!-- Cron Schedule Reference -->
                    <div class="bg-purple-50 border border-purple-200 rounded-xl p-4 mb-4">
                        <h4 class="font-semibold text-purple-800 mb-2"><i class="fas fa-info-circle mr-1"></i> Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚</h4>
                        <div class="text-sm text-purple-700 space-y-1">
                            <p><strong>Î£Ï…Ï‡Î½ÏŒÏ„Î·Ï„Î±:</strong> <span x-text="getCronDescription()"></span></p>
                            <p><strong>Base URL:</strong> <span class="font-mono bg-white px-2 py-0.5 rounded" x-text="getAutoBaseUrl()"></span> <span class="text-xs text-purple-500">(auto-detected)</span></p>
                            <p><strong>Environment:</strong> <span class="font-mono bg-white px-2 py-0.5 rounded" x-text="getServerType()"></span></p>
                        </div>
                    </div>

                    <!-- Instructions based on environment -->
                    <!-- Windows Instructions -->
                    <div x-show="isLocalhost()" class="bg-blue-50 border-l-4 border-blue-500 rounded-xl p-4">
                        <h4 class="font-semibold text-blue-800 mb-2"><i class="fab fa-windows mr-1"></i> ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Î³Î¹Î± Windows Task Scheduler</h4>
                        <ol class="text-sm text-blue-700 space-y-1 list-decimal list-inside">
                            <li>Î‘Î½Î¿Î¯Î¾Ï„Îµ <strong>Task Scheduler</strong> (taskschd.msc)</li>
                            <li>Click <strong>Create Basic Task</strong></li>
                            <li>ÎŒÎ½Î¿Î¼Î±: <code class="bg-white px-1 rounded">TaskMesh Deadline Reminders</code></li>
                            <li>Trigger: Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„Î·Î½ ÎµÏ€Î¹Î¸Ï…Î¼Î·Ï„Î® ÏƒÏ…Ï‡Î½ÏŒÏ„Î·Ï„Î±</li>
                            <li>Action: <strong>Start a program</strong></li>
                            <li>Program: <code class="bg-white px-1 rounded">C:\xampp\php\php.exe</code></li>
                            <li>Arguments: Î¤Î¿ path Ï„Î¿Ï… script (Î²Î». Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰)</li>
                            <li>Click <strong>Finish</strong></li>
                        </ol>
                        <div class="mt-3 p-2 bg-white rounded-lg">
                            <p class="text-xs text-gray-600"><strong>ğŸ’¡ Tip:</strong> Î’ÎµÎ²Î±Î¹Ï‰Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Ï„Î¿ XAMPP Ï„ÏÎ­Ï‡ÎµÎ¹ ÏŒÏ„Î±Î½ ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Ï„Î¿ task</p>
                        </div>
                    </div>

                    <!-- Linux/Production Instructions -->
                    <div x-show="!isLocalhost()" class="bg-green-50 border-l-4 border-green-500 rounded-xl p-4">
                        <h4 class="font-semibold text-green-800 mb-2"><i class="fab fa-linux mr-1"></i> ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Î³Î¹Î± Linux Server / Hostinger</h4>
                        <ol class="text-sm text-green-700 space-y-1 list-decimal list-inside">
                            <li>Login ÏƒÏ„Î¿ <strong>hPanel / cPanel</strong></li>
                            <li>Advanced â†’ <strong>Cron Jobs</strong></li>
                            <li>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ <strong>Custom</strong></li>
                            <li>Î‘Î½Ï„Î¹Î³ÏÎ¬ÏˆÏ„Îµ Ï„Î·Î½ Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ ÎµÎ½Ï„Î¿Î»Î®</li>
                            <li>Î‘Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÏ„Îµ Ï„Î¿ username Î¼Îµ Ï„Î¿ Î´Î¹ÎºÏŒ ÏƒÎ±Ï‚ (Ï€.Ï‡. <code class="bg-white px-1 rounded">u123456789</code>)</li>
                            <li>Click <strong>Create</strong></li>
                        </ol>
                        <div class="mt-3 p-2 bg-white rounded-lg">
                            <p class="text-xs text-gray-600"><strong>ğŸ’¡ Tip:</strong> Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± logs: <code class="bg-gray-100 px-1 rounded">TaskMesh/cron/cron.log</code></p>
                        </div>
                    </div>
                </div>

                <!-- Messages -->
                <div x-show="preferencesError" x-transition class="bg-red-100 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded-xl" x-text="preferencesError"></div>
                <div x-show="preferencesSuccess" x-transition class="bg-green-100 border-l-4 border-green-500 text-green-700 px-4 py-3 rounded-xl" x-text="preferencesSuccess"></div>

                <!-- Actions -->
                <div class="flex gap-3 pt-4">
                    <button type="submit" :disabled="savingPreferences"
                            class="px-8 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold rounded-xl hover:shadow-lg transition disabled:opacity-50">
                        <span x-show="!savingPreferences"><i class="fas fa-save mr-2"></i>Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</span>
                        <span x-show="savingPreferences"><i class="fas fa-spinner fa-spin mr-2"></i>Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·...</span>
                    </button>
                </div>
            </form>
        </div>

        <!-- Email Templates Tab -->
        <div x-show="activeTab === 'templates'" class="space-y-6">
            <div class="glass rounded-3xl p-8">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ¨ Email Template Designer</h2>
                        <p class="text-gray-600 mt-1">Î£Ï‡ÎµÎ´Î¹Î¬ÏƒÏ„Îµ Ï„Î± email templates Î¼Îµ Î´Ï…Î½Î±Î¼Î¹ÎºÎ¬ Ï€ÎµÎ´Î¯Î±</p>
                    </div>
                </div>

                <!-- Template Type Selection -->
                <div class="mb-6">
                    <label class="block text-gray-700 font-semibold mb-2">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Template</label>
                    <select x-model="selectedTemplateType" @change="loadTemplate()"
                            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200">
                        <option value="">-- Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„ÏÏ€Î¿ email --</option>
                        <option value="task_assigned">ğŸ“‹ Task Assignment</option>
                        <option value="task_completed">âœ… Task Completion</option>
                        <option value="subtask_completed">â˜‘ï¸ Subtask Completion</option>
                        <option value="comment_added">ğŸ’¬ New Comment</option>
                        <option value="deadline_reminder">â° Deadline Reminder</option>
                        <option value="team_invitation">ğŸ‘¥ Team Invitation</option>
                        <option value="direct_message">ğŸ“¨ Direct Message</option>
                        <option value="test_email">ğŸ§ª Test Email</option>
                    </select>
                </div>

                <!-- Template Editor -->
                <div x-show="selectedTemplateType" class="space-y-6">
                    
                    <!-- Subject -->
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">Subject Line</label>
                        <input type="text" x-model="currentTemplate.subject"
                               placeholder="Email subject..."
                               class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200">
                        <p class="text-xs text-gray-500 mt-1">Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î±: {{task_title}}, {{user_name}}, {{team_name}}, {{date}}</p>
                    </div>

                    <!-- Design Settings -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Header Color Start</label>
                            <div class="flex gap-2">
                                <input type="color" x-model="currentTemplate.header_gradient_start"
                                       class="w-12 h-12 rounded-lg cursor-pointer border border-gray-300">
                                <input type="text" x-model="currentTemplate.header_gradient_start"
                                       class="flex-1 px-4 py-3 rounded-xl border border-gray-300">
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Header Color End</label>
                            <div class="flex gap-2">
                                <input type="color" x-model="currentTemplate.header_gradient_end"
                                       class="w-12 h-12 rounded-lg cursor-pointer border border-gray-300">
                                <input type="text" x-model="currentTemplate.header_gradient_end"
                                       class="flex-1 px-4 py-3 rounded-xl border border-gray-300">
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Header Icon</label>
                            <input type="text" x-model="currentTemplate.header_icon"
                                   placeholder="ğŸ“§"
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 text-2xl text-center">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Button Color</label>
                            <div class="flex gap-2">
                                <input type="color" x-model="currentTemplate.button_color"
                                       class="w-12 h-12 rounded-lg cursor-pointer border border-gray-300">
                                <input type="text" x-model="currentTemplate.button_color"
                                       class="flex-1 px-4 py-3 rounded-xl border border-gray-300">
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Button Text Color</label>
                            <div class="flex gap-2">
                                <input type="color" x-model="currentTemplate.button_text_color"
                                       class="w-12 h-12 rounded-lg cursor-pointer border border-gray-300">
                                <input type="text" x-model="currentTemplate.button_text_color"
                                       class="flex-1 px-4 py-3 rounded-xl border border-gray-300">
                            </div>
                        </div>
                    </div>

                    <!-- Content Template with WYSIWYG Editor -->
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">Email Content (Visual Editor)</label>
                        
                        <!-- Editor Mode Tabs -->
                        <div class="flex gap-2 mb-3">
                            <button type="button" @click="editorMode = 'visual'; initTinyMCE()"
                                    :class="editorMode === 'visual' ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700'"
                                    class="px-4 py-2 rounded-lg font-semibold transition flex items-center gap-2">
                                <i class="fas fa-edit"></i> Visual
                            </button>
                            <button type="button" @click="switchToHtml()"
                                    :class="editorMode === 'html' ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700'"
                                    class="px-4 py-2 rounded-lg font-semibold transition flex items-center gap-2">
                                <i class="fas fa-code"></i> HTML
                            </button>
                        </div>

                        <!-- Visual Editor (TinyMCE) -->
                        <div x-show="editorMode === 'visual'" x-cloak>
                            <div id="tinymce-container" class="border border-gray-300 rounded-xl overflow-hidden">
                                <textarea id="email-editor"></textarea>
                            </div>
                        </div>

                        <!-- HTML Editor -->
                        <div x-show="editorMode === 'html'" x-cloak>
                            <textarea x-model="currentTemplate.content_template" rows="15"
                                      id="html-editor"
                                      placeholder="<p>Email content with {{placeholders}}...</p>"
                                      class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 font-mono text-sm"></textarea>
                        </div>

                        <!-- Dynamic Fields Panel -->
                        <div class="mt-3 p-4 bg-gray-50 rounded-xl border border-gray-200">
                            <div class="flex items-center gap-2 mb-3">
                                <i class="fas fa-magic text-purple-600"></i>
                                <span class="font-semibold text-gray-700">Dynamic Fields</span>
                                <span class="text-xs text-gray-500">(click to insert)</span>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <template x-for="field in availableFields" :key="field">
                                    <button type="button" @click="insertFieldToEditor(field)"
                                            class="px-3 py-2 bg-white border border-purple-300 text-purple-700 rounded-lg text-sm hover:bg-purple-50 hover:border-purple-400 transition flex items-center gap-1 shadow-sm">
                                        <i class="fas fa-plus-circle text-xs"></i>
                                        <span x-text="'{{' + field + '}}'"></span>
                                    </button>
                                </template>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">
                                <i class="fas fa-info-circle mr-1"></i>
                                These fields will be replaced with actual data when the email is sent.
                            </p>
                        </div>
                    </div>

                    <!-- Messages -->
                    <div x-show="templateError" x-transition class="bg-red-100 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded-xl" x-text="templateError"></div>
                    <div x-show="templateSuccess" x-transition class="bg-green-100 border-l-4 border-green-500 text-green-700 px-4 py-3 rounded-xl" x-text="templateSuccess"></div>

                    <!-- Actions -->
                    <div class="flex gap-3 pt-4">
                        <button type="button" @click="saveTemplate" :disabled="savingTemplate"
                                class="px-8 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white font-semibold rounded-xl hover:shadow-lg transition disabled:opacity-50">
                            <span x-show="!savingTemplate"><i class="fas fa-save mr-2"></i>Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Template</span>
                            <span x-show="savingTemplate"><i class="fas fa-spinner fa-spin mr-2"></i>Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·...</span>
                        </button>
                        <button type="button" @click="previewTemplate"
                                class="px-8 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-semibold rounded-xl hover:shadow-lg transition">
                            <i class="fas fa-eye mr-2"></i>Preview
                        </button>
                        <button type="button" @click="resetTemplate"
                                class="px-8 py-3 bg-gray-200 text-gray-700 font-semibold rounded-xl hover:bg-gray-300 transition">
                            <i class="fas fa-undo mr-2"></i>Reset to Default
                        </button>
                    </div>
                </div>
            </div>

            <!-- Preview Panel -->
            <div x-show="showPreview" class="glass rounded-3xl p-8">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-800">ğŸ‘ï¸ Email Preview</h3>
                    <button @click="showPreview = false" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="border border-gray-200 rounded-xl overflow-hidden">
                    <iframe id="previewFrame" class="w-full h-[600px] bg-white"></iframe>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// API Request Helper
async function apiRequest(endpoint, options = {}) {
    const token = localStorage.getItem('token');
    
    const config = {
        ...options,
        headers: {
            'Content-Type': 'application/json',
            ...options.headers
        }
    };

    if (token) {
        config.headers['Authorization'] = `Bearer ${token}`;
    }

    const response = await fetch(`/TaskMesh/api${endpoint}`, config);
    
    if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    return await response.json();
}

function settingsPage() {
    return {
        currentUser: JSON.parse(localStorage.getItem('user') || '{}'),
        userRole: JSON.parse(localStorage.getItem('user') || '{}').role || 'MEMBER',
        isAdmin: false,
        activeTab: 'profile',
        
        // System Settings (New)
        systemSettings: {
            // Security
            password_min_length: 8,
            password_require_uppercase: true,
            password_require_lowercase: true,
            password_require_numbers: true,
            password_require_special: false,
            session_timeout: 1440,
            max_login_attempts: 5,
            lockout_duration: 15,
            // Appearance
            date_format: 'DD/MM/YYYY',
            time_format: '24h',
            timezone: 'Europe/Athens',
            language: 'el',
            logo_path: null,
            primary_color: '#667eea',
            // System
            task_auto_archive_days: 30,
            registration_mode: 'open',
            default_user_role: 'USER',
            max_team_size: 50,
            max_file_upload_mb: 10,
            allowed_file_types: 'jpg,jpeg,png,pdf,doc,docx,xls,xlsx,txt',
            // Notifications
            websocket_enabled: true,
            websocket_port: 8080,
            notification_email: true,
            notification_inapp: true,
            notification_push: false,
            notification_batch_mode: 'immediate',
            quiet_hours_start: null,
            quiet_hours_end: null,
            // Maintenance
            maintenance_mode: false,
            maintenance_message: 'System is under maintenance. Please check back soon.',
            last_backup: null,
            last_optimization: null,
            auto_backup_enabled: false,
            backup_frequency: 'daily',
            // Data Retention
            archive_completed_tasks_days: 90,
            delete_archived_tasks_days: 365,
            delete_inactive_users_months: 12,
            clean_old_notifications_days: 30,
            clean_old_comments_days: 0,
            last_retention_cleanup: null
        },
        healthCheck: {
            database: 'Checking...',
            websocket: 'Checking...',
            disk: 'Checking...'
        },
        
        // Email Settings (SMTP)
        emailSettings: {
            smtp_host: 'smtp.gmail.com',
            smtp_port: 587,
            smtp_encryption: 'tls',
            smtp_username: '',
            smtp_password: '',
            smtp_from_email: '',
            smtp_from_name: 'TaskMesh Notifications',
            notifications_enabled: false,
            password_is_set: false
        },
        testEmailAddress: '',
        savingEmail: false,
        testingEmail: false,
        emailError: '',
        emailSuccess: '',
        
        // Email Preferences
        preferences: {
            notify_task_assigned: true,
            notify_task_completed: true,
            notify_subtask_created: true,
            notify_subtask_completed: true,
            notify_comment_added: true,
            notify_deadline_reminder: true,
            notify_team_invitation: true,
            notify_direct_message: true,
            team_filter: 'all',
            selected_teams: [],
            email_digest: 'instant'
        },
        teams: [],
        savingPreferences: false,
        preferencesError: '',
        preferencesSuccess: '',
        
        // Cron Job Settings
        cronFrequency: 'daily9am',
        
        // Email Templates
        selectedTemplateType: '',
        currentTemplate: {
            subject: '',
            header_gradient_start: '#667eea',
            header_gradient_end: '#764ba2',
            header_icon: 'ğŸ“§',
            button_color: '#667eea',
            button_text_color: '#ffffff',
            content_template: ''
        },
        availableFields: ['user_name', 'task_title', 'team_name', 'deadline', 'message', 'sender_name', 'action_url', 'button_text', 'date', 'subtask_title'],
        savingTemplate: false,
        templateError: '',
        templateSuccess: '',
        showPreview: false,
        editorMode: 'visual',
        tinyMCEInitialized: false,

        async init() {
            this.isAdmin = this.currentUser.role === 'ADMIN';
            this.userRole = this.currentUser.role || 'MEMBER';
            
            // Set initial tab based on role
            if (this.userRole === 'ADMIN') {
                this.activeTab = 'security';
                await this.loadSystemSettings();
                await this.loadEmailSettings();
                await this.loadPreferences();
                await this.loadTeams();
            } else {
                this.activeTab = 'profile';
            }
        },

        // System Settings Functions
        async loadSystemSettings() {
            try {
                const response = await apiRequest('/settings/system.php');
                if (response.success && response.settings) {
                    // Flatten nested structure
                    Object.keys(response.settings).forEach(category => {
                        Object.assign(this.systemSettings, response.settings[category]);
                    });
                }
            } catch (err) {
                console.error('Error loading system settings:', err);
            }
        },

        async saveSystemSettings(category) {
            try {
                // Get settings for this category
                const categorySettings = {};
                const categoryMap = {
                    'security': ['password_min_length', 'password_require_uppercase', 'password_require_lowercase', 'password_require_numbers', 'password_require_special', 'session_timeout', 'max_login_attempts', 'lockout_duration'],
                    'appearance': ['date_format', 'time_format', 'timezone', 'language', 'logo_path', 'primary_color'],
                    'system': ['installation_path', 'task_auto_archive_days', 'registration_mode', 'default_user_role', 'max_team_size', 'max_file_upload_mb', 'allowed_file_types'],
                    'notifications': ['websocket_enabled', 'websocket_port', 'notification_email', 'notification_inapp', 'notification_push', 'notification_batch_mode', 'quiet_hours_start', 'quiet_hours_end'],
                    'maintenance': ['maintenance_mode', 'maintenance_message', 'auto_backup_enabled', 'backup_frequency'],
                    'retention': ['archive_completed_tasks_days', 'delete_archived_tasks_days', 'delete_inactive_users_months', 'clean_old_notifications_days', 'clean_old_comments_days']
                };

                const keys = categoryMap[category] || [];
                keys.forEach(key => {
                    if (this.systemSettings[key] !== undefined) {
                        categorySettings[key] = this.systemSettings[key];
                    }
                });

                const response = await apiRequest('/settings/system.php', {
                    method: 'POST',
                    body: JSON.stringify({ settings: categorySettings })
                });

                if (response.success) {
                    this.showToast('Success', response.message || 'Settings saved successfully', 'success');
                    
                    // If installation_path was changed, reload the page to apply new paths
                    if (category === 'system' && categorySettings.installation_path !== undefined) {
                        setTimeout(() => {
                            this.showToast('Info', 'Reloading to apply new installation path...', 'info');
                            setTimeout(() => window.location.reload(), 1000);
                        }, 1000);
                    }
                }
            } catch (err) {
                this.showToast('Error', err.message || 'Failed to save settings', 'error');
            }
        },
        
        // Detect installation path automatically
        detectInstallationPath() {
            const currentPath = window.location.pathname;
            const parts = currentPath.split('/').filter(p => p);
            
            const knownFiles = ['dashboard.html', 'dashboard-production.html', 'index.html', 'settings.html'];
            const knownDirs = ['pages', 'api', 'assets'];
            
            let baseParts = [];
            for (let part of parts) {
                if (knownFiles.includes(part) || knownDirs.includes(part)) {
                    break;
                }
                baseParts.push(part);
            }
            
            const detectedPath = baseParts.length > 0 ? '/' + baseParts.join('/') : '';
            this.systemSettings.installation_path = detectedPath;
            
            this.showToast('Success', `Detected path: "${detectedPath || '/ (root)'}"`, 'success');
        },

        async uploadLogo(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file
            if (!['image/png', 'image/jpeg', 'image/jpg'].includes(file.type)) {
                this.showToast('Error', 'Only PNG and JPG files are allowed', 'error');
                return;
            }

            if (file.size > 2 * 1024 * 1024) {
                this.showToast('Error', 'File size must be less than 2MB', 'error');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('logo', file);

                const response = await fetch(`${API_URL}/settings/logo.php`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: formData
                });

                const result = await response.json();
                if (result.success) {
                    this.systemSettings.logo_path = result.logo_path;
                    await this.saveSystemSettings('appearance');
                    this.showToast('Success', 'Logo uploaded successfully', 'success');
                } else {
                    throw new Error(result.error);
                }
            } catch (err) {
                this.showToast('Error', err.message || 'Failed to upload logo', 'error');
            }
        },

        async removeLogo() {
            if (!confirm('Remove logo and use default branding?')) return;
            
            this.systemSettings.logo_path = null;
            await this.saveSystemSettings('appearance');
            this.showToast('Success', 'Logo removed', 'success');
        },

        async runHealthCheck() {
            this.healthCheck = {
                database: 'Checking...',
                websocket: 'Checking...',
                disk: 'Checking...'
            };

            try {
                const response = await apiRequest('/maintenance/health-check.php');
                if (response.success) {
                    this.healthCheck = response.health;
                }
            } catch (err) {
                this.showToast('Error', 'Failed to run health check', 'error');
            }
        },

        async optimizeDatabase() {
            if (!confirm('Optimize database tables? This may take a few moments.')) return;

            try {
                const response = await apiRequest('/maintenance/optimize.php', { method: 'POST' });
                if (response.success) {
                    this.systemSettings.last_optimization = new Date().toLocaleString('el-GR');
                    this.showToast('Success', response.message || 'Database optimized', 'success');
                }
            } catch (err) {
                this.showToast('Error', err.message || 'Failed to optimize database', 'error');
            }
        },

        async clearCache() {
            if (!confirm('Clear all cache files?')) return;

            try {
                const response = await apiRequest('/maintenance/clear-cache.php', { method: 'POST' });
                if (response.success) {
                    this.showToast('Success', response.message || 'Cache cleared', 'success');
                }
            } catch (err) {
                this.showToast('Error', err.message || 'Failed to clear cache', 'error');
            }
        },

        async createBackup() {
            if (!confirm('Create a backup of the database?')) return;

            try {
                const response = await apiRequest('/maintenance/backup.php', { method: 'POST' });
                if (response.success) {
                    this.systemSettings.last_backup = new Date().toLocaleString('el-GR');
                    
                    // Download backup file
                    if (response.download_url) {
                        window.open(response.download_url, '_blank');
                    }
                    
                    this.showToast('Success', response.message || 'Backup created', 'success');
                }
            } catch (err) {
                this.showToast('Error', err.message || 'Failed to create backup', 'error');
            }
        },

        async restoreBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.sql';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                if (!confirm('âš ï¸ WARNING: This will replace all current data! Are you sure?')) return;

                try {
                    const formData = new FormData();
                    formData.append('backup', file);

                    const response = await fetch(`${API_URL}/maintenance/restore.php`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        },
                        body: formData
                    });

                    const result = await response.json();
                    if (result.success) {
                        this.showToast('Success', result.message || 'Backup restored', 'success');
                        setTimeout(() => window.location.reload(), 2000);
                    } else {
                        throw new Error(result.error);
                    }
                } catch (err) {
                    this.showToast('Error', err.message || 'Failed to restore backup', 'error');
                }
            };
            input.click();
        },

        async exportData() {
            try {
                const response = await apiRequest('/maintenance/export.php', { method: 'POST' });
                if (response.success && response.download_url) {
                    window.open(response.download_url, '_blank');
                    this.showToast('Success', 'Data exported successfully', 'success');
                }
            } catch (err) {
                this.showToast('Error', err.message || 'Failed to export data', 'error');
            }
        },

        async importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                if (!confirm('Import data from JSON file? Existing data will be merged.')) return;

                try {
                    const formData = new FormData();
                    formData.append('data', file);

                    const response = await fetch(`${API_URL}/maintenance/import.php`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        },
                        body: formData
                    });

                    const result = await response.json();
                    if (result.success) {
                        this.showToast('Success', result.message || 'Data imported', 'success');
                    } else {
                        throw new Error(result.error);
                    }
                } catch (err) {
                    this.showToast('Error', err.message || 'Failed to import data', 'error');
                }
            };
            input.click();
        },

        async toggleMaintenanceMode() {
            const action = this.systemSettings.maintenance_mode ? 'enable' : 'disable';
            if (!confirm(`${action === 'enable' ? 'Enable' : 'Disable'} maintenance mode?`)) {
                this.systemSettings.maintenance_mode = !this.systemSettings.maintenance_mode;
                return;
            }

            await this.saveSystemSettings('maintenance');
        },

        async runRetentionCleanup() {
            if (!confirm('Run data retention cleanup now? This will permanently delete old data based on your retention settings.')) {
                return;
            }

            try {
                const data = await apiRequest('/maintenance/retention-cleanup.php', {
                    method: 'POST'
                });

                if (data.success) {
                    const summary = `Cleanup completed:\n` +
                                  `- Tasks archived: ${data.cleaned.tasks_archived}\n` +
                                  `- Tasks deleted: ${data.cleaned.tasks_deleted}\n` +
                                  `- Users deleted: ${data.cleaned.users_deleted}\n` +
                                  `- Notifications deleted: ${data.cleaned.notifications_deleted}\n` +
                                  `- Comments deleted: ${data.cleaned.comments_deleted}`;
                    
                    alert(summary);
                    this.showToast('Success', 'Retention cleanup completed', 'success');
                    
                    // Reload settings to get updated timestamp
                    await this.loadSystemSettings();
                }
            } catch (err) {
                alert('Cleanup failed: ' + (err.message || 'Unknown error'));
                this.showToast('Error', 'Cleanup failed', 'error');
            }
        },

        showToast(title, message, type = 'info') {
            // Use dashboard's toast system if available
            if (window.dashboardApp && window.dashboardApp.showToast) {
                window.dashboardApp.showToast(title, message);
            } else {
                alert(`${title}: ${message}`);
            }
        },

        async loadEmailSettings() {
            try {
                const settings = await apiRequest('/settings/email.php');
                this.emailSettings = settings;
                this.emailSettings.smtp_password = '';
            } catch (err) {
                console.error('Error loading email settings:', err);
            }
        },

        async saveEmailSettings() {
            this.savingEmail = true;
            this.emailError = '';
            this.emailSuccess = '';

            try {
                const dataToSend = {...this.emailSettings};
                if (!dataToSend.smtp_password) {
                    delete dataToSend.smtp_password;
                }
                
                const result = await apiRequest('/settings/email.php', {
                    method: 'PUT',
                    body: JSON.stringify(dataToSend)
                });
                this.emailSettings = result;
                this.emailSettings.smtp_password = '';
                
                this.emailSuccess = 'âœ“ Settings saved successfully!';
                setTimeout(() => this.emailSuccess = '', 3000);
            } catch (err) {
                this.emailError = err.message || 'Failed to save settings';
            } finally {
                this.savingEmail = false;
            }
        },

        async testEmail() {
            if (!this.testEmailAddress) return;

            this.testingEmail = true;
            this.emailError = '';
            this.emailSuccess = '';

            try {
                await apiRequest('/settings/test-email.php', {
                    method: 'POST',
                    body: JSON.stringify({ test_email: this.testEmailAddress })
                });
                
                this.emailSuccess = 'âœ“ Test email sent to ' + this.testEmailAddress;
                setTimeout(() => this.emailSuccess = '', 5000);
            } catch (err) {
                this.emailError = 'âœ— Failed: ' + (err.message || 'Check SMTP settings');
            } finally {
                this.testingEmail = false;
            }
        },

        async loadPreferences() {
            try {
                const prefs = await apiRequest('/settings/email-preferences.php');
                if (prefs && prefs.id) {
                    this.preferences = {
                        ...this.preferences,
                        ...prefs,
                        selected_teams: prefs.team_filter !== 'all' ? prefs.team_filter.split(',').map(Number) : []
                    };
                    this.preferences.team_filter = prefs.team_filter === 'all' ? 'all' : 'selected';
                }
            } catch (err) {
                console.error('Error loading preferences:', err);
            }
        },

        async loadTeams() {
            try {
                this.teams = await apiRequest('/teams/index.php');
            } catch (err) {
                console.error('Error loading teams:', err);
            }
        },

        async savePreferences() {
            this.savingPreferences = true;
            this.preferencesError = '';
            this.preferencesSuccess = '';

            try {
                const dataToSend = {
                    ...this.preferences,
                    team_filter: this.preferences.team_filter === 'all' ? 'all' : this.preferences.selected_teams.join(',')
                };
                delete dataToSend.selected_teams;
                
                await apiRequest('/settings/email-preferences.php', {
                    method: 'PUT',
                    body: JSON.stringify(dataToSend)
                });
                
                this.preferencesSuccess = 'âœ“ Preferences saved!';
                setTimeout(() => this.preferencesSuccess = '', 3000);
            } catch (err) {
                this.preferencesError = err.message || 'Failed to save preferences';
            } finally {
                this.savingPreferences = false;
            }
        },

        async loadTemplate() {
            if (!this.selectedTemplateType) return;

            try {
                const template = await apiRequest(`/settings/email-templates.php?type=${this.selectedTemplateType}`);
                if (template && template.id) {
                    this.currentTemplate = template;
                    
                    // Update TinyMCE content if initialized
                    if (this.editorMode === 'visual') {
                        await this.initTinyMCE();
                        this.$nextTick(() => {
                            if (window.tinymce && tinymce.get('email-editor')) {
                                tinymce.get('email-editor').setContent(template.content_template || '');
                            }
                        });
                    }
                }
            } catch (err) {
                console.error('Error loading template:', err);
                this.currentTemplate = {
                    subject: '',
                    header_gradient_start: '#667eea',
                    header_gradient_end: '#764ba2',
                    header_icon: 'ğŸ“§',
                    button_color: '#667eea',
                    button_text_color: '#ffffff',
                    content_template: ''
                };
            }
        },

        insertField(field) {
            const textarea = document.querySelector('textarea[x-model="currentTemplate.content_template"]');
            const cursorPos = textarea.selectionStart;
            const text = this.currentTemplate.content_template;
            this.currentTemplate.content_template = text.slice(0, cursorPos) + '{{' + field + '}}' + text.slice(cursorPos);
        },

        // TinyMCE WYSIWYG Editor Functions
        async initTinyMCE() {
            // Load TinyMCE if not already loaded
            if (!window.tinymce) {
                await this.loadTinyMCEScript();
            }

            // Remove existing instance if any
            if (tinymce.get('email-editor')) {
                tinymce.get('email-editor').remove();
            }

            // Initialize TinyMCE
            tinymce.init({
                selector: '#email-editor',
                height: 400,
                menubar: true,
                plugins: [
                    'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
                    'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
                    'insertdatetime', 'media', 'table', 'help', 'wordcount', 'emoticons',
                    'codesample', 'quickbars', 'visualchars'
                ],
                toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | ' +
                         'forecolor backcolor | alignleft aligncenter alignright alignjustify | ' +
                         'bullist numlist outdent indent | link image media table | ' +
                         'emoticons charmap | removeformat | code fullscreen | help',
                toolbar_mode: 'sliding',
                quickbars_selection_toolbar: 'bold italic | quicklink h2 h3 blockquote quickimage quicktable',
                contextmenu: 'link image table',
                content_style: `
                    body { 
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; 
                        font-size: 14px; 
                        line-height: 1.6;
                        color: #374151;
                        padding: 15px;
                    }
                    p { margin: 0 0 1em 0; }
                    a { color: #3b82f6; }
                    .dynamic-field { 
                        background: linear-gradient(135deg, #a855f7, #7c3aed);
                        color: white;
                        padding: 2px 8px;
                        border-radius: 4px;
                        font-size: 12px;
                        display: inline-block;
                    }
                `,
                font_family_formats: 'Arial=arial,helvetica,sans-serif; Courier New=courier new,courier,monospace; Georgia=georgia,palatino; Helvetica=helvetica; Times New Roman=times new roman,times; Verdana=verdana,geneva',
                font_size_formats: '8pt 10pt 12pt 14pt 16pt 18pt 24pt 36pt 48pt',
                block_formats: 'Paragraph=p; Heading 1=h1; Heading 2=h2; Heading 3=h3; Heading 4=h4; Preformatted=pre',
                color_map: [
                    '667eea', 'Primary Blue',
                    '764ba2', 'Primary Purple',
                    '10b981', 'Success Green',
                    'f59e0b', 'Warning Yellow',
                    'ef4444', 'Error Red',
                    '3b82f6', 'Blue',
                    '8b5cf6', 'Purple',
                    '6b7280', 'Gray',
                    '374151', 'Dark Gray',
                    '111827', 'Black',
                    'ffffff', 'White'
                ],
                setup: (editor) => {
                    // Set initial content
                    editor.on('init', () => {
                        editor.setContent(this.currentTemplate.content_template || '');
                        this.tinyMCEInitialized = true;
                    });

                    // Update model on change
                    editor.on('change keyup', () => {
                        this.currentTemplate.content_template = editor.getContent();
                    });

                    // Add custom button for dynamic fields
                    editor.ui.registry.addMenuButton('dynamicfields', {
                        text: 'âš¡ Fields',
                        tooltip: 'Insert Dynamic Field',
                        fetch: (callback) => {
                            const items = this.availableFields.map(field => ({
                                type: 'menuitem',
                                text: `{{${field}}}`,
                                onAction: () => {
                                    editor.insertContent(`<span class="dynamic-field">{{${field}}}</span>&nbsp;`);
                                }
                            }));
                            callback(items);
                        }
                    });

                    // Append to toolbar
                    editor.on('init', () => {
                        const toolbar = editor.getContainer().querySelector('.tox-toolbar__primary');
                        if (toolbar) {
                            // Dynamic fields button is part of the toolbar via setup
                        }
                    });
                },
                // Add dynamic fields button to toolbar
                toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | ' +
                         'forecolor backcolor | alignleft aligncenter alignright alignjustify | ' +
                         'bullist numlist outdent indent | link image media table | ' +
                         'emoticons charmap | dynamicfields | removeformat | code fullscreen | help',
                promotion: false,
                branding: false
            });
        },

        async loadTinyMCEScript() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                // Using jsDelivr CDN for TinyMCE 6 (no API key required)
                script.src = 'https://cdn.jsdelivr.net/npm/tinymce@6/tinymce.min.js';
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        },

        switchToHtml() {
            // Save content from TinyMCE before switching
            if (window.tinymce && tinymce.get('email-editor')) {
                this.currentTemplate.content_template = tinymce.get('email-editor').getContent();
            }
            this.editorMode = 'html';
        },

        insertFieldToEditor(field) {
            if (this.editorMode === 'visual' && window.tinymce && tinymce.get('email-editor')) {
                tinymce.get('email-editor').insertContent(`<span class="dynamic-field">{{${field}}}</span>&nbsp;`);
            } else {
                // HTML mode - insert at cursor position
                const textarea = document.getElementById('html-editor');
                if (textarea) {
                    const start = textarea.selectionStart;
                    const end = textarea.selectionEnd;
                    const text = this.currentTemplate.content_template;
                    const fieldText = `{{${field}}}`;
                    this.currentTemplate.content_template = text.substring(0, start) + fieldText + text.substring(end);
                    
                    // Set cursor position after inserted field
                    this.$nextTick(() => {
                        textarea.focus();
                        textarea.setSelectionRange(start + fieldText.length, start + fieldText.length);
                    });
                }
            }
        },

        updateEditorContent() {
            // Sync content when switching to visual mode
            if (this.editorMode === 'visual' && window.tinymce && tinymce.get('email-editor')) {
                tinymce.get('email-editor').setContent(this.currentTemplate.content_template || '');
            }
        },

        async saveTemplate() {
            this.savingTemplate = true;
            this.templateError = '';
            this.templateSuccess = '';

            // Get content from TinyMCE if in visual mode
            if (this.editorMode === 'visual' && window.tinymce && tinymce.get('email-editor')) {
                this.currentTemplate.content_template = tinymce.get('email-editor').getContent();
            }

            try {
                await apiRequest('/settings/email-templates.php', {
                    method: 'PUT',
                    body: JSON.stringify({
                        template_type: this.selectedTemplateType,
                        ...this.currentTemplate
                    })
                });
                
                this.templateSuccess = 'âœ“ Template saved successfully!';
                setTimeout(() => this.templateSuccess = '', 3000);
            } catch (err) {
                this.templateError = err.message || 'Failed to save template';
            } finally {
                this.savingTemplate = false;
            }
        },

        previewTemplate() {
            // Get content from TinyMCE if in visual mode
            if (this.editorMode === 'visual' && window.tinymce && tinymce.get('email-editor')) {
                this.currentTemplate.content_template = tinymce.get('email-editor').getContent();
            }
            
            const previewHtml = this.generatePreviewHtml();
            const iframe = document.getElementById('previewFrame');
            iframe.srcdoc = previewHtml;
            this.showPreview = true;
        },

        generatePreviewHtml() {
            const sampleData = {
                user_name: 'Î“Î¹Î¬Î½Î½Î·Ï‚ Î Î±Ï€Î±Î´ÏŒÏ€Î¿Ï…Î»Î¿Ï‚',
                task_title: 'Sample Task Title',
                team_name: 'Development Team',
                deadline: '30/11/2025',
                message: 'Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Î­Î½Î± Î´Î¿ÎºÎ¹Î¼Î±ÏƒÏ„Î¹ÎºÏŒ Î¼Î®Î½Ï…Î¼Î±.',
                sender_name: 'ÎœÎ±ÏÎ¯Î± ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¯Î½Î¿Ï…',
                action_url: '#',
                button_text: 'Î”ÎµÏ‚ Ï„Î¿ Task',
                date: new Date().toLocaleDateString('el-GR'),
                subtask_title: 'Sample Subtask'
            };

            let content = this.currentTemplate.content_template;
            Object.keys(sampleData).forEach(key => {
                content = content.replace(new RegExp(`{{${key}}}`, 'g'), sampleData[key]);
            });

            return `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <style>body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }</style>
            </head>
            <body>
                <div style="max-width: 600px; margin: 0 auto; background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <div style="background: linear-gradient(135deg, ${this.currentTemplate.header_gradient_start} 0%, ${this.currentTemplate.header_gradient_end} 100%); padding: 40px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 10px;">${this.currentTemplate.header_icon}</div>
                        <h1 style="color: white; margin: 0; font-size: 24px;">${this.currentTemplate.subject.replace(/{{(\w+)}}/g, (m, key) => sampleData[key] || m)}</h1>
                    </div>
                    <div style="padding: 30px;">
                        ${content}
                        <div style="text-align: center; margin-top: 30px;">
                            <a href="#" style="display: inline-block; background: ${this.currentTemplate.button_color}; color: ${this.currentTemplate.button_text_color}; text-decoration: none; padding: 14px 32px; border-radius: 8px; font-weight: 600;">Î”ÎµÏ‚ Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚</a>
                        </div>
                    </div>
                </div>
            </body>
            </html>`;
        },

        async resetTemplate() {
            if (!confirm('Reset template to default? This cannot be undone.')) return;
            
            try {
                await apiRequest(`/settings/email-templates.php?type=${this.selectedTemplateType}&reset=1`, {
                    method: 'DELETE'
                });
                await this.loadTemplate();
                
                // Update TinyMCE content
                if (this.editorMode === 'visual' && window.tinymce && tinymce.get('email-editor')) {
                    tinymce.get('email-editor').setContent(this.currentTemplate.content_template || '');
                }
                
                this.templateSuccess = 'âœ“ Template reset to default!';
                setTimeout(() => this.templateSuccess = '', 3000);
            } catch (err) {
                this.templateError = 'Failed to reset template';
            }
        },

        // Cron Job Helper Functions
        getAutoBaseUrl() {
            // Auto-detect base URL from current location
            const origin = window.location.origin;
            const pathname = window.location.pathname;
            // Extract TaskMesh path (e.g., /TaskMesh or /app)
            const match = pathname.match(/^\/[^\/]+/);
            const basePath = match ? match[0] : '/TaskMesh';
            return origin + basePath;
        },

        isLocalhost() {
            try {
                const hostname = window.location.hostname;
                return hostname === 'localhost' || hostname === '127.0.0.1' || hostname.startsWith('192.168.');
            } catch (e) {
                return true; // Default to localhost if error
            }
        },

        getServerInfo() {
            try {
                const baseUrl = this.getAutoBaseUrl();
                const url = new URL(baseUrl);
                const hostname = url.hostname;
                const pathname = url.pathname || '/TaskMesh';
                
                if (hostname === 'localhost' || hostname === '127.0.0.1') {
                    // Windows XAMPP localhost
                    return {
                        type: 'localhost',
                        phpPath: 'C:\\xampp\\php\\php.exe',
                        scriptPath: `C:\\xampp\\htdocs${pathname.replace(/\//g, '\\\\')}\\cron\\deadline_reminders.php`,
                        logPath: `C:\\xampp\\htdocs${pathname.replace(/\//g, '\\\\')}\\cron\\cron.log`,
                        description: 'Windows XAMPP (localhost)'
                    };
                } else {
                    // Production Linux server - extract domain for username hint
                    const domainParts = hostname.split('.');
                    const usernameHint = domainParts[0].replace(/[^a-z0-9]/gi, '').substring(0, 8);
                    
                    return {
                        type: 'production',
                        phpPath: '/usr/bin/php',
                        scriptPath: `/home/${usernameHint}_user/public_html${pathname}/cron/deadline_reminders.php`,
                        logPath: `/home/${usernameHint}_user/public_html${pathname}/cron/cron.log`,
                        description: `Production Server (${hostname})`,
                        domain: hostname
                    };
                }
            } catch (e) {
                // Default fallback
                return {
                    type: 'localhost',
                    phpPath: 'C:\\xampp\\php\\php.exe',
                    scriptPath: 'C:\\xampp\\htdocs\\TaskMesh\\cron\\deadline_reminders.php',
                    logPath: 'C:\\xampp\\htdocs\\TaskMesh\\cron\\cron.log',
                    description: 'Windows XAMPP (localhost)'
                };
            }
        },

        getCronCommand() {
            const server = this.getServerInfo();
            
            const schedules = {
                'hourly': '0 * * * *',
                'every30min': '0,30 * * * *',
                'daily9am': '0 9 * * *',
                'daily9pm': '0 21 * * *',
                'twice': '0 9,17 * * *',
                'every6hours': '0 */6 * * *'
            };
            
            const schedule = schedules[this.cronFrequency] || schedules['daily9am'];
            
            if (server.type === 'localhost') {
                // Windows Task Scheduler command (for reference)
                return `# Windows - Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Task Scheduler:\n"${server.phpPath}" "${server.scriptPath}"`;
            } else {
                // Linux cron command
                return `${schedule} ${server.phpPath} ${server.scriptPath} >> ${server.logPath} 2>&1`;
            }
        },

        getCronDescription() {
            const descriptions = {
                'hourly': 'ÎšÎ¬Î¸Îµ ÏÏÎ± ÏƒÏ„Î¿ Î»ÎµÏ€Ï„ÏŒ 0 (00:00, 01:00, 02:00...)',
                'every30min': 'ÎšÎ¬Î¸Îµ 30 Î»ÎµÏ€Ï„Î¬ (00:00, 00:30, 01:00...)',
                'daily9am': 'ÎœÎ¯Î± Ï†Î¿ÏÎ¬ Ï„Î·Î½ Î·Î¼Î­ÏÎ± ÏƒÏ„Î¹Ï‚ 09:00 Ï€Î¼',
                'daily9pm': 'ÎœÎ¯Î± Ï†Î¿ÏÎ¬ Ï„Î·Î½ Î·Î¼Î­ÏÎ± ÏƒÏ„Î¹Ï‚ 21:00 (9 Î¼Î¼)',
                'twice': 'Î”ÏÎ¿ Ï†Î¿ÏÎ­Ï‚ Ï„Î·Î½ Î·Î¼Î­ÏÎ± ÏƒÏ„Î¹Ï‚ 09:00 ÎºÎ±Î¹ 17:00',
                'every6hours': 'ÎšÎ¬Î¸Îµ 6 ÏÏÎµÏ‚ (00:00, 06:00, 12:00, 18:00)'
            };
            return descriptions[this.cronFrequency] || descriptions['daily9am'];
        },

        getServerType() {
            const server = this.getServerInfo();
            return server.description;
        },

        copyCronCommand() {
            const command = this.getCronCommand();
            navigator.clipboard.writeText(command).then(() => {
                // Show temporary success message
                const btn = event.target.closest('button');
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check text-green-400"></i> <span class="ml-1 text-xs">Copied!</span>';
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Î‘Î½Ï„Î¹Î³ÏÎ¬ÏˆÏ„Îµ Ï‡ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î±: ' + command);
            });
        }
    }
}
</script>
